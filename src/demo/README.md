# B+ Tree Demo Examples

–≠—Ç–∞ –ø–∞–ø–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è B+ –¥–µ—Ä–µ–≤–∞ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π. –ö–∞–∂–¥—ã–π –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–º–µ—Ä–æ–≤

### üå≥ [01-basic-usage.ts](./01-basic-usage.ts)
**–ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ B+ –¥–µ—Ä–µ–≤–∞**

–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:
- –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: insert, find, remove, count
- –†–∞–±–æ—Ç–∞ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ (duplicate keys)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏

```bash
# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–º–µ—Ä–∞
bun run src/demo/01-basic-usage.ts
```

### üîÑ [02-transactions.ts](./02-transactions.ts)
**–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**

–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ò–∑–æ–ª—è—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (snapshot isolation)
- Commit –∏ abort –æ–ø–µ—Ä–∞—Ü–∏–∏
- Two-Phase Commit (2PC) –ø—Ä–æ—Ç–æ–∫–æ–ª
- Batch –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
- Copy-on-Write –º–µ—Ö–∞–Ω–∏–∑–º

```bash
# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–º–µ—Ä–∞
bun run src/demo/02-transactions.ts
```

### üîç [03-functional-queries.ts](./03-functional-queries.ts)
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏**

–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ query API (map, filter, reduce)
- Range –∑–∞–ø—Ä–æ—Å—ã –∏ –∫—É—Ä—Å–æ—Ä—ã
- –°–ª–æ–∂–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –ê–≥—Ä–µ–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–º–µ—Ä–∞
bun run src/demo/03-functional-queries.ts
```

### ‚ö° [04-performance.ts](./04-performance.ts)
**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –±–µ–Ω—á–º–∞—Ä–∫–∏**

–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:
- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
- –í–ª–∏—è–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–µ—Ä–µ–≤–∞ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
- Bulk –æ–ø–µ—Ä–∞—Ü–∏–∏ vs –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –°–∏–º—É–ª—è—Ü–∏—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- Range –∑–∞–ø—Ä–æ—Å—ã

```bash
# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–º–µ—Ä–∞
bun run src/demo/04-performance.ts
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø—Ä–∏–º–µ—Ä–æ–≤

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
bun install

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –ø–æ –æ—á–µ—Ä–µ–¥–∏
bun run src/demo/01-basic-usage.ts
bun run src/demo/02-transactions.ts
bun run src/demo/03-functional-queries.ts
bun run src/demo/04-performance.ts
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
bun test

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
bun run coverage
```

## üìä –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### B+ Tree Configuration

```typescript
// –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Ä–µ–≤–∞
const tree = new BPlusTree<ValueType, KeyType>(
  minDegree,    // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–µ–ø–µ–Ω—å (‚â• 2)
  unique,       // –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ (true/false)
  comparator    // –§—É–Ω–∫—Ü–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
)
```

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

```typescript
// –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
const txCtx = new TransactionContext(tree)

// –û–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
tree.insert_in_transaction(key, value, txCtx)
tree.remove_in_transaction(key, txCtx)
const values = tree.get_all_in_transaction(key, txCtx)

// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
await txCtx.commit()  // –∏–ª–∏ txCtx.abort()
```

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

```typescript
import { query, map, filter, reduce } from '../query'

const result = await query(
  tree.range(1, 100),           // –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
  filter(([k, v]) => v.active), // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
  map(([k, v]) => v.name),      // –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è
  reduce((acc, name) => {       // –ê–≥—Ä–µ–≥–∞—Ü–∏—è
    acc.push(name)
    return acc
  }, [])
)(tree)
```

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 1. –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ ID
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π

### 2. –ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- –ù–µ—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- Range –∑–∞–ø—Ä–æ—Å—ã –ø–æ —Ü–µ–Ω–∞–º
- Batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è

### 3. –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –∫–∞–∫ –∫–ª—é—á–∏
- Range –∑–∞–ø—Ä–æ—Å—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏

### 4. –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –∏–∑–º–µ—Ä–µ–Ω–∏—è–º
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ range –∑–∞–ø—Ä–æ—Å—ã

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –í—ã–±–æ—Ä –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏
- **–ú–∞–ª—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (3-5)**: –ú–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏, –±–æ–ª—å—à–µ —É—Ä–æ–≤–Ω–µ–π
- **–ë–æ–ª—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (10-20)**: –ë–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏, –º–µ–Ω—å—à–µ —É—Ä–æ–≤–Ω–µ–π
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: 5-10 –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- **Sorted inserts**: –ë—ã—Å—Ç—Ä–µ–µ —Å–ª—É—á–∞–π–Ω—ã—Ö –≤—Å—Ç–∞–≤–æ–∫
- **Batch operations**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –≥—Ä—É–ø–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π
- **Range queries**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö find –æ–ø–µ—Ä–∞—Ü–∏–π

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é
- **Copy-on-Write**: –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **Transaction isolation**: –ò–∑–æ–ª–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ–∂–¥—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
- **Garbage collection**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —É–∑–ª–æ–≤

## üìà –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å | –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å |
|----------|-------------------|---------------------------|
| Insert   | O(log n)          | O(1)                      |
| Find     | O(log n)          | O(1)                      |
| Remove   | O(log n)          | O(1)                      |
| Range    | O(log n + k)      | O(k)                      |

–≥–¥–µ n - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤, k - —Ä–∞–∑–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

## üõ†Ô∏è –û—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–µ—Ä–µ–≤–∞
```typescript
const isValid = tree.validate()
console.log('Tree is valid:', isValid)
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–µ—Ä–µ–≤–∞
```typescript
console.log('Tree size:', tree.size)
console.log('Min key:', tree.min)
console.log('Max key:', tree.max)
```

### –ü–µ—á–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
```typescript
import { print_node } from '../print_node'
console.log(print_node(tree).join('\n'))
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](../../README.md)
- [API Reference](../../README.md#api-reference)
- [–¢–µ—Å—Ç—ã](../test/) - –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤
- [–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥](../) - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è B+ –¥–µ—Ä–µ–≤–∞

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∏–¥–µ–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –∏–ª–∏ —É–ª—É—á—à–µ–Ω–∏–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö:

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `demo/`
2. –°–ª–µ–¥—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —Å—Ç–∏–ª—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
3. –î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ —ç—Ç–æ—Ç README
4. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

---

**üí° –°–æ–≤–µ—Ç**: –ù–∞—á–Ω–∏—Ç–µ —Å `01-basic-usage.ts` –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ—Å–Ω–æ–≤, –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–º –ø—Ä–∏–º–µ—Ä–∞–º –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.