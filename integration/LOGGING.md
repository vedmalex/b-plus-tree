# üìù –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è B+ Tree

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤ B+ –¥–µ—Ä–µ–≤–µ, –º—ã –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ `console.log` –≤—ã–∑–æ–≤–æ–≤, —á—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ –æ—à–∏–±–∫–∞–º –ø–∞—Ä—Å–µ—Ä–∞ –∏–∑-–∑–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–∂–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏, –Ω–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –≤–ª–∏—è—Ç—å –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

## üöÄ –†–µ—à–µ–Ω–∏—è

–ú—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ **–¥–≤–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è** —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏:

### 1. üîÑ Runtime Logger (`src/logger.ts`)
**–ü–æ–¥—Ö–æ–¥:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```typescript
import { debug, warn, error, transaction } from './logger';

// Debug –ª–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ development –∏–ª–∏ —Å DEBUG_BTREE=true
debug('Debug message');

// –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –í–°–ï–ì–î–ê
warn('Warning message');
error('Error message');

// Transaction –ª–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ development –∏–ª–∏ —Å DEBUG_BTREE=true
transaction('Transaction started');
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏ –≤—Å–µ–≥–¥–∞ –≤—ã–≤–æ–¥—è—Ç—Å—è
- ‚ùå –ù–µ–±–æ–ª—å—à–æ–π overhead –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –¥–ª—è debug/verbose)
- ‚ùå –ö–æ–¥ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –±–∞–Ω–¥–ª–µ

### 2. ‚ö° Build-time Debug (`src/debug.ts`)
**–ü–æ–¥—Ö–æ–¥:** –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ —Å–±–æ—Ä–∫–µ

```typescript
import { log, ifDev, trace, debugAssert } from './debug';

// –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –ø—Ä–æ–¥–∞–∫—à–Ω-–±–∞–Ω–¥–ª–∞
log('Debug message');
ifDev(() => {
  // –í–µ—Å—å —ç—Ç–æ—Ç –±–ª–æ–∫ —É–¥–∞–ª—è–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
  const expensiveData = generateDebugInfo();
  log('Expensive debug:', expensiveData);
});
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ù—É–ª–µ–≤–æ–π overhead –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- ‚úÖ –ú–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞
- ‚úÖ –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–æ—Ä–æ–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –æ—Ç–ª–∞–¥–∫–∏
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±–æ—Ä–∫–∏

## üìã –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –í–∫–ª—é—á–∏—Ç—å debug –ª–æ–≥–∏
DEBUG_BTREE=true

# –í–∫–ª—é—á–∏—Ç—å verbose –ª–æ–≥–∏
VERBOSE_BTREE=true

# –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º (–æ—Ç–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –ª–æ–≥–∏)
NODE_ENV=production
```

## üõ† –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –û–±—ã—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
npm run test

# –° debug –ª–æ–≥–∞–º–∏
npm run test:debug

# –° verbose –ª–æ–≥–∞–º–∏
npm run test:verbose

# –ë–µ–∑ –ª–æ–≥–æ–≤ (–ø—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º)
npm run test:silent
```

## üé® –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Runtime Logger
```typescript
import { debug, warn, error, transaction, ifDebug } from './logger';

function processTransaction(txId: string) {
  transaction(`Starting transaction ${txId}`); // –¢–æ–ª—å–∫–æ –≤ debug —Ä–µ–∂–∏–º–µ

  // –£—Å–ª–æ–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ—Ä–æ–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
  ifDebug(() => {
    const memUsage = process.memoryUsage();
    debug(`Memory usage: ${JSON.stringify(memUsage)}`);
  });

  try {
    // ... –ª–æ–≥–∏–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    debug('Transaction completed successfully'); // –¢–æ–ª—å–∫–æ –≤ debug —Ä–µ–∂–∏–º–µ
  } catch (err) {
    error('Transaction failed:', err); // –í–°–ï–ì–î–ê –≤—ã–≤–æ–¥–∏—Ç—Å—è
    warn('Check transaction parameters'); // –í–°–ï–ì–î–ê –≤—ã–≤–æ–¥–∏—Ç—Å—è
    throw err;
  }
}
```

### Build-time Debug
```typescript
import { log, ifDev, trace, debugAssert, dumpTree } from './debug';

function complexOperation(data: any[]) {
  // Assertion —É–¥–∞–ª—è–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
  debugAssert(data.length > 0, 'Data array should not be empty');

  // –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (—É–¥–∞–ª—è–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)
  return trace('complex-operation', () => {
    // –î–æ—Ä–æ–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–ª–∞–¥–∫–∏ (–ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç—Å—è)
    ifDev(() => {
      dumpTree(someTree, 'Before complex operation');
      log('Processing', data.length, 'items');
    });

    const result = processData(data);

    ifDev(() => {
      dumpTree(someTree, 'After complex operation');
      log('Result:', result);
    });

    return result;
  });
}
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–±–æ—Ä–∫–∏

–í `build.ts` —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

```typescript
define: {
  PRODUCTION: JSON.stringify(process.env.NODE_ENV === 'production'),
}
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–µ `debug.ts` –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è—Ç—å –∫–æ–¥ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ö—Ä–∏—Ç–µ—Ä–∏–π                            | Runtime Logger     | Build-time Debug                        |
|-------------------------------------|--------------------|-----------------------------------------|
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ** | –ù–µ–±–æ–ª—å—à–æ–π overhead | –ù—É–ª–µ–≤–æ–π overhead                        |
| **–†–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞**                   | –ë–æ–ª—å—à–µ             | –ú–µ–Ω—å—à–µ                                  |
| **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**          | –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞—è      | –ü—Ä–æ—Å—Ç–∞—è                                 |
| **–ì–∏–±–∫–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**              | –í—ã—Å–æ–∫–∞—è            | –°—Ä–µ–¥–Ω—è—è                                 |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**                    | –í—ã—Å–æ–∫–∞—è            | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è                           |
| **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è/–æ—à–∏–±–∫–∏**           | –í—Å–µ–≥–¥–∞ –≤—ã–≤–æ–¥—è—Ç—Å—è   | –û—à–∏–±–∫–∏ –≤—Å–µ–≥–¥–∞, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è —É–¥–∞–ª—è—é—Ç—Å—è |

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Runtime Logger –¥–ª—è:
- –û–±—ã—á–Ω—ã—Ö debug —Å–æ–æ–±—â–µ–Ω–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –∏ –æ—à–∏–±–æ–∫
- –°–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –≥–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Build-time Debug –¥–ª—è:
- –î–æ—Ä–æ–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –æ—Ç–ª–∞–¥–∫–∏
- –î–∞–º–ø–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
- Assertions –∏ –ø—Ä–æ–≤–µ—Ä–æ–∫
- –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —É—á–∞—Å—Ç–∫–æ–≤

## üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

1. **–ó–∞–º–µ–Ω–∏—Ç–µ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏:**
```typescript
// –ë—ã–ª–æ:
// console.log(`[transaction] Starting ${txId}`);

// –°—Ç–∞–ª–æ:
transaction(`Starting ${txId}`);
```

2. **–û–±–µ—Ä–Ω–∏—Ç–µ –¥–æ—Ä–æ–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**
```typescript
// –ë—ã–ª–æ:
// const debugInfo = generateExpensiveDebugInfo();
// console.log('Debug info:', debugInfo);

// –°—Ç–∞–ª–æ:
ifDev(() => {
  const debugInfo = generateExpensiveDebugInfo();
  log('Debug info:', debugInfo);
});
```

3. **–î–æ–±–∞–≤—å—Ç–µ assertions:**
```typescript
// –ë—ã–ª–æ:
// if (!node) throw new Error('Node not found');

// –°—Ç–∞–ª–æ:
debugAssert(node !== undefined, 'Node not found');
if (!node) throw new Error('Node not found');
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ **–ù–µ—Ç –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–µ—Ä–∞** - –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- ‚úÖ **–ì–∏–±–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- ‚úÖ **–ù—É–ª–µ–≤–æ–π overhead –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ** - –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—á–∞—Å—Ç–∫–æ–≤
- ‚úÖ **–õ—É—á—à–∞—è –æ—Ç–ª–∞–¥–∫–∞** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- ‚úÖ **–ú–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞** - —É–¥–∞–ª–µ–Ω–∏–µ debug –∫–æ–¥–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å!