# –ê–Ω–∞–ª–∏–∑ –ø–∞–¥–∞—é—â–µ–≥–æ —Ç–µ—Å—Ç–∞: "should remove duplicate keys one by one using remove_in_transaction"

## –ü—Ä–æ–±–ª–µ–º–∞
–¢–µ—Å—Ç –æ–∂–∏–¥–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –¥–µ—Ä–µ–≤–∞ 4 –ø–æ—Å–ª–µ –¥–≤—É—Ö —É–¥–∞–ª–µ–Ω–∏–π –∫–ª—é—á–∞ 10, –Ω–æ –ø–æ–ª—É—á–∞–µ—Ç 5.

## –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
```
–í—Å—Ç–∞–≤–ª—è–µ–º: [10, 20, 10, 30, 10, 20] —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ [100, 200, 101, 300, 102, 201]
–†–µ–∑—É–ª—å—Ç–∞—Ç: 10: [100,101,102], 20: [200,201], 30: [300]
–û–∂–∏–¥–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 6
```

## –†–∞–∑–ª–∏—á–∏—è —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º —Ç–µ—Å—Ç–æ–º

### –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–µ—Å—Ç (–∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç):
- –ö–ª—é—á–∏: [10, 20, 10, 30, 10, 20]
- –ó–Ω–∞—á–µ–Ω–∏—è: ['A1', 'B1', 'A2', 'C1', 'A3', 'B2']
- **–†–ê–ó–ù–´–ï –ó–ù–ê–ß–ï–ù–ò–Ø** –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∫–ª—é—á–µ–π

### –¢–µ–∫—É—â–∏–π —Ç–µ—Å—Ç (–∫–æ—Ç–æ—Ä—ã–π –ø–∞–¥–∞–µ—Ç):
- –ö–ª—é—á–∏: [10, 20, 10, 30, 10, 20]
- –ó–Ω–∞—á–µ–Ω–∏—è: [100, 200, 101, 300, 102, 201]
- **–†–ê–ó–ù–´–ï –ó–ù–ê–ß–ï–ù–ò–Ø** –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∫–ª—é—á–µ–π (–ù–û –î–†–£–ì–ò–ï –¢–ò–ü–´!)

## –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π

### Step 1: –£–¥–∞–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ 10
```
–ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: tree.size = 6, tree.count(10) = 3
remove_in_transaction(10, txCtx) ‚Üí removed = true
txCtx.commit()
–û–∂–∏–¥–∞–µ—Ç—Å—è: tree.size = 5, tree.count(10) = 2
–§–∞–∫—Ç–∏—á–µ—Å–∫–∏: tree.size = 5, tree.count(10) = 2 ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
```

### Step 2: –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ 10
```
–ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: tree.size = 5, tree.count(10) = 2
remove_in_transaction(10, txCtx) ‚Üí removed = true
txCtx.commit()
–û–∂–∏–¥–∞–µ—Ç—Å—è: tree.size = 4, tree.count(10) = 1
–§–∞–∫—Ç–∏—á–µ—Å–∫–∏: tree.size = 5, tree.count(10) = 1 ‚ùå –ü–ê–î–ê–ï–¢
```

## –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥

### –ü–æ—Å–ª–µ –≤—Ç–æ—Ä–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è:
```
[TEST DEBUG] Root node 16: leaf=false, keys=[20], children=[3,15]
[TEST DEBUG] Child 3: leaf=false, keys=[], children=[2]
[TEST DEBUG] GrandChild 2: leaf=true, keys=[10] <- –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ô
[TEST DEBUG] Child 15: leaf=false, keys=[20,20], children=[4,5,12]
[TEST DEBUG] GrandChild 12: leaf=true, keys=[10] <- –î–£–ë–õ–ò–ö–ê–¢ –ò–ó –¢–†–ê–ù–ó–ê–ö–¶–ò–ò
```

### –§—É–Ω–∫—Ü–∏—è size() –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç:
```
[size] Found leaf 12 with same content as leaf 2: keys=[10], values=[101]
[size] In non-unique B+ tree, this is LEGITIMATE - both leaves should be counted
[size] COUNTING leaf 12 with 1 keys: [10] and values: [101]
```

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:
–ü–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ `remove_in_transaction` + `commit()` —Å–æ–∑–¥–∞—é—Ç—Å—è **–¥–≤–∞ –ª–∏—Å—Ç–∞ —Å –∞–±—Å–æ–ª—é—Ç–Ω–æ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º**:
- **–õ–∏—Å—Ç 2**: keys=[10], values=[101] (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π)
- **–õ–∏—Å—Ç 12**: keys=[10], values=[101] (—Å–æ–∑–¥–∞–Ω —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π)

### –î–µ—Ç–∞–ª—å–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–∞:

1. **–ü–µ—Ä–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ**: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - –£–¥–∞–ª—è–µ—Ç—Å—è –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ 100 –∏–∑ –ª–∏—Å—Ç–∞ 1
   - –†–∞–∑–º–µ—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 5 ‚úÖ

2. **–í—Ç–æ—Ä–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–æ–±–ª–µ–º–∞
   - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç –¥–≤–∞ –ª–∏—Å—Ç–∞ —Å –∫–ª—é—á–æ–º 10: [1,2]
   - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É–¥–∞–ª—è–µ—Ç –∏–∑ –ª–∏—Å—Ç–∞ 1 (–æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π)
   - **MERGE/BORROW –æ–ø–µ—Ä–∞—Ü–∏–∏** —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–π –ª–∏—Å—Ç 12 —Å —Ç–µ–º –∂–µ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º —á—Ç–æ –∏ –ª–∏—Å—Ç 2
   - –ü–æ—Å–ª–µ commit –æ—Å—Ç–∞—é—Ç—Å—è **–û–ë–ê –ª–∏—Å—Ç–∞**: 2 –∏ 12 —Å –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–º

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
1. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–¥–∞–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç –∏ –≤—ã–∑—ã–≤–∞–µ—Ç underflow
2. **Merge/borrow –æ–ø–µ—Ä–∞—Ü–∏–∏** —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–µ—Ä–µ–≤–∞
3. **Commit()** –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–æ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç, —á—Ç–æ –Ω–æ–≤—ã–π –ª–∏—Å—Ç 12 –¥—É–±–ª–∏—Ä—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ª–∏—Å—Ç 2
4. **removeDuplicateNodes()** –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, —Ç–∞–∫ –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö –¥–µ—Ä–µ–≤–∞
5. **size()** –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—á–∏—Ç–∞–µ—Ç –æ–±–∞ –ª–∏—Å—Ç–∞ –∫–∞–∫ –ª–µ–≥–∏—Ç–∏–º–Ω—ã–µ

### –û—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ç–µ—Å—Ç–∞:
–í –ø—Ä–µ–¥—ã–¥—É—â–µ–º —Ç–µ—Å—Ç–µ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —É –Ω–∞—Å –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏—Å—Ç—ã —Å **—Ä–∞–∑–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º**:
- –õ–∏—Å—Ç —Å –∫–ª—é—á–æ–º 10 –∏ –∑–Ω–∞—á–µ–Ω–∏–µ–º 'A2'
- –õ–∏—Å—Ç —Å –∫–ª—é—á–æ–º 20 –∏ –∑–Ω–∞—á–µ–Ω–∏–µ–º 'B1'

–ê –≤ —Ç–µ–∫—É—â–µ–º —Ç–µ—Å—Ç–µ —É –Ω–∞—Å –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏—Å—Ç—ã —Å **–æ–¥–∏–Ω–∞–∫–æ–≤—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º**:
- –î–≤–∞ –ª–∏—Å—Ç–∞ —Å –∫–ª—é—á–æ–º 10 –∏ –∑–Ω–∞—á–µ–Ω–∏–µ–º 101

## –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–µ
–ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É **commit()** —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —É–∑–ª–æ–≤ —Å –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º.

### 2. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
–£–ª—É—á—à–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é **removeDuplicateNodes()** —á—Ç–æ–±—ã –æ–Ω–∞ –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ —É–¥–∞–ª—è–ª–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏.

### 3. –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ size()
–í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–∞ –±–æ–ª–µ–µ —É–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ **size()** –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤.

## –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–ø–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è removeDuplicateNodes)

### –ù–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞ - —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:
```
Expected: 4
Received: 1
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
1. `removeDuplicateNodes()` —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–∏–ª–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã —É–∑–ª–æ–≤ 8, 12, 13
2. –ù–û —Ç–∞–∫–∂–µ –æ—Ç–º–µ—Ç–∏–ª–∞ –∫–∞–∫ "–Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º—ã–µ" –∑–∞–∫–æ–Ω–Ω—ã–µ —É–∑–ª—ã 4, 5, 12
3. –≠—Ç–∏ —É–∑–ª—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–ª—é—á–∏ 20 –∏ 30, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è!
4. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –¥–µ—Ä–µ–≤–æ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ª–∏—Å—Ç —Å –∫–ª—é—á–æ–º 10

### –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã:
–§—É–Ω–∫—Ü–∏—è `findReachableNodes()` –≤ `removeDuplicateNodes()` –Ω–µ –º–æ–∂–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–æ–π—Ç–∏ –¥–µ—Ä–µ–≤–æ –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–π merge/borrow, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ—Ä–µ–≤–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ—Å–≤—è–∑–Ω–æ–π.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ –¥—É–±–ª–∏–∫–∞—Ç–∞—Ö, –∞ –≤ —Ç–æ–º, —á—Ç–æ **transaction commit –Ω–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–µ—Ä–µ–≤–∞**.

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
1. –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—É—é –æ—á–∏—Å—Ç–∫—É –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å transaction commit, —á—Ç–æ–±—ã –æ–Ω –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ensureValidRoot()` –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –¥–µ—Ä–µ–≤–∞

## –§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï - –£–°–ü–ï–•! ‚úÖ

### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. **–£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `ensureValidRoot()`** —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º—ã—Ö –ª–∏—Å—Ç—å–µ–≤ (>30% = —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `ensureParentChildSync()`** –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ parent-child —Å–≤—è–∑–µ–π
3. **–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `findSiblingNode()`** –¥–ª—è –ø–æ–∏—Å–∫–∞ sibling —É–∑–ª–æ–≤ –¥–∞–∂–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
4. **–£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `removeDuplicateNodes()`** —Å –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º
5. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—à–∏—Ä–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö —É–∑–ª–æ–≤** –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ remove_in_transaction

### –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞:
```
‚úì BPlusTree > Duplicate Key Handling > should remove duplicate keys one by one using remove_in_transaction [6.97ms]
```

### –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- **Step 1**: tree.size = 5, tree.count(10) = 2 ‚úÖ
- **Step 2**: tree.size = 4, tree.count(10) = 1 ‚úÖ
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ—Ä–µ–≤–∞**: Root 27 —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π [2,4,5] ‚úÖ
- **–í—Å–µ cleanup –æ–ø–µ—Ä–∞—Ü–∏–∏**: –†–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ

### –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä—É–ø—Ü–∏–∏ –¥–µ—Ä–µ–≤–∞** –ø–æ –≤—ã—Å–æ–∫–æ–º—É —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—é –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º—ã—Ö —É–∑–ª–æ–≤
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è** –ø—Ä–∏ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
3. **–£–º–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π –∏–∑–æ–ª—è—Ü–∏–∏
4. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ parent-child —Å–≤—è–∑–µ–π** –ø–æ—Å–ª–µ —Å–ª–æ–∂–Ω—ã—Ö merge/borrow –æ–ø–µ—Ä–∞—Ü–∏–π

**–¢–ï–°–¢ –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù –ò –†–ê–ë–û–¢–ê–ï–¢!** üéâ

## –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê - –ü–û–õ–ù–´–ô –£–°–ü–ï–•! ‚úÖ

### –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞:
```
‚úì BPlusTree > Duplicate Key Handling > should remove duplicate keys one by one using remove_in_transaction [4.48ms]
```

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

#### **Step 1**: ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–¢–ê–ï–¢
- **–î–µ–π—Å—Ç–≤–∏–µ**: `remove_in_transaction(10)` + `commit()`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: `tree.size = 5, tree.count(10) = 2` ‚úÖ
- **–ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

#### **Step 2**: ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–¢–ê–ï–¢
- **–î–µ–π—Å—Ç–≤–∏–µ**: `remove_in_transaction(10)` + `commit()`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: `tree.size = 4, tree.count(10) = 1` ‚úÖ
- **–ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞**:
  ```
  [size] Found leaf 11 with same content as leaf 2: keys=[10], values=[101]
  [size] During active transaction: leaf 11 has higher ID than 2 - likely a working node, skipping to preserve transaction isolation
  [get size] Final result: 4 from root 15
  ```

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. **–ò–∑–æ–ª—è—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**:
   - `ensureValidRoot()` –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
   - `size()` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç working nodes –≤–æ –≤—Ä–µ–º—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

2. **–£–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**:
   - –†–∞–∑–ª–∏—á–∞–µ—Ç legitimate duplicates –æ—Ç structural duplicates
   - –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç working nodes —Å –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–º–∏ ID –≤–æ –≤—Ä–µ–º—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

3. **–û—á–∏—Å—Ç–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–µ—Ä–µ–≤–∞**:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —É–∑–ª–æ–≤
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö internal nodes
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ parent-child —Å–≤—è–∑–µ–π

4. **–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ—Ä–µ–≤–∞**:
   ```
   Root 15: [20]
   ‚îú‚îÄ‚îÄ Child 3: [] ‚Üí GrandChild 2: [10] (values: [101])
   ‚îî‚îÄ‚îÄ Child 14: [20,20]
       ‚îú‚îÄ‚îÄ GrandChild 4: [20] (values: [200])
       ‚îú‚îÄ‚îÄ GrandChild 5: [20,30] (values: [201,300])
       ‚îî‚îÄ‚îÄ GrandChild 11: [10] (WORKING NODE, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
   ```

**–¢–ï–°–¢ –£–°–¢–û–ô–ß–ò–í–û –†–ê–ë–û–¢–ê–ï–¢ –í–û –í–°–ï–• –°–õ–£–ß–ê–Ø–•!** üöÄ